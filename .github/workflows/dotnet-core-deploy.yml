name: deploy

on:
  workflow_dispatch:

jobs:
  checkout:

    runs-on: ubuntu-latest

    steps:    
    - name: Setup .NET Core
      uses: actions/setup-dotnet@v1
      with:
        dotnet-version: 3.1.301
    - name: Checkout
      uses: actions/checkout@v2
      with:
        ref: "master"
    - name: Install dependencies
      run: dotnet restore
    - name: Publish
      run: dotnet publish HiraganeoApp --configuration Release -r linux-x64 -p:PublishSingleFile=true -p:PublishTrimmed=true --self-contained true --no-build
    - name: Upload
      uses: actions/upload-artifact@v2
      with:
        name: "hiraganeo"
        path: HiraganeoApp/bin/Release/netcoreapp3.1/linux-x64/publish
    - name: Deploy
      env:
        SSH_HOST: axonited.net
        SSH_USER: ${{ secrets.USER }}
        SSH_PASS: ${{ secrets.PASSWORD }}
      run: |
        echo "starting"
        cd $GITHUB_WORKSPACE
        ls -la
        echo "server copy here"
        echo "finished"       
